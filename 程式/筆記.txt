ğŸ” 1. ä½¿ç”¨è€…ç™»å…¥

å‰ç«¯é€å‡ºç™»å…¥è«‹æ±‚ (ä¾‹å¦‚ React / Vue ç™¼é€ API)ï¼š

POST /api/users/login
Content-Type: application/json

{
  "email": "test@example.com",
  "password": "123456"
}

ğŸ–¥ 2. å¾Œç«¯é©—è­‰å¸³è™Ÿå¯†ç¢¼

å¾Œç«¯ (ASP.NET Core) æ”¶åˆ°å¾Œåšï¼š

å»è³‡æ–™åº«æ‰¾ Email ç‚º test@example.com çš„ Userã€‚

æª¢æŸ¥å¯†ç¢¼æ˜¯å¦æ­£ç¢º (å¯¦å‹™ä¸Šæœƒå­˜ å“ˆå¸Œéçš„å¯†ç¢¼ï¼Œä¾‹å¦‚ BCrypt)ã€‚

å¦‚æœæ­£ç¢º â†’ ç”¢ç”Ÿ JWT Tokenã€‚

ğŸ”‘ 3. å¾Œç«¯ç”¢ç”Ÿ JWT Token

å‡è¨­è³‡æ–™ï¼š

userId = "abc-123"

email = "test@example.com"

secretKey = "MySuperSecretKey"

éæœŸæ™‚é–“ = 1 å°æ™‚

(1) å»ºç«‹ Header
{ "alg": "HS256", "typ": "JWT" }


Base64Url ç·¨ç¢¼å¾Œï¼š

eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9

(2) å»ºç«‹ Payload
{
  "sub": "abc-123",
  "email": "test@example.com",
  "exp": 1712345678
}


Base64Url ç·¨ç¢¼å¾Œï¼š

eyJzdWIiOiJhYmMtMTIzIiwiZW1haWwiOiJ0ZXN0QGV4YW1wbGUuY29tIiwiZXhwIjoxNzEyMzQ1Njc4fQ

(3) å»ºç«‹ç°½ç« 

æŠŠå…©æ®µé€£èµ·ä¾†ï¼š

data = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhYmMtMTIzIiwiZW1haWwiOiJ0ZXN0QGV4YW1wbGUuY29tIiwiZXhwIjoxNzEyMzQ1Njc4fQ"


ç”¨ HMAC-SHA256 + secretKey ç®—å‡ºé›œæ¹Šï¼š

signature = HMACSHA256(data, "MySuperSecretKey")


çµæœå† Base64Url ç·¨ç¢¼ï¼Œå‡è¨­ï¼š

abc123xyz987

(4) æœ€çµ‚ Token
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhYmMtMTIzIiwiZW1haWwiOiJ0ZXN0QGV4YW1wbGUuY29tIiwiZXhwIjoxNzEyMzQ1Njc4fQ.abc123xyz987

ğŸ“© 4. å¾Œç«¯å›å‚³çµ¦å‰ç«¯

ç™»å…¥æˆåŠŸçš„ API å›æ‡‰ï¼š

{
  "success": true,
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9....abc123xyz987"
}

ğŸ“¦ 5. å‰ç«¯å„²å­˜ Token

å‰ç«¯ï¼ˆç€è¦½å™¨ / Appï¼‰æ”¶åˆ°å¾Œï¼Œé€šå¸¸æœƒå­˜åˆ°ï¼š

localStorage â†’ æ°¸ä¹…ä¿å­˜ï¼Œé™¤éæ¸…é™¤ç€è¦½å™¨è³‡æ–™ã€‚

sessionStorage â†’ åªåœ¨ç€è¦½å™¨åˆ†é å­˜åœ¨ã€‚

App â†’ é€šå¸¸å­˜ SQLite æˆ– Secure Storageã€‚

ä¾‹å­ (å‰ç«¯ JS)ï¼š

localStorage.setItem("jwt", token);

ğŸš€ 6. å‰ç«¯å¸¶è‘— Token å‘¼å«å—ä¿è­· API

å‡è¨­è¦å‘¼å«ã€Œå–å¾—å€‹äººè³‡æ–™ã€çš„ APIï¼š

GET /api/users/me
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9....abc123xyz987

ğŸ›¡ 7. å¾Œç«¯é©—è­‰ Token

å¾Œç«¯åšé€™äº›äº‹ï¼š

æ‹¿åˆ° Tokenï¼Œæ‹†æˆä¸‰æ®µ (Header, Payload, Signature)ã€‚

ç”¨åŒæ¨£çš„ secretKey é‡æ–°è¨ˆç®—ç°½ç« ã€‚

æ¯”å°ã€Œç®—å‡ºä¾†çš„ç°½ç« ã€ == ã€ŒToken å¸¶ä¾†çš„ç°½ç« ã€ã€‚

å¦‚æœä¸€è‡´ï¼Œè€Œä¸” exp é‚„æ²’éæœŸ â†’ Token æœ‰æ•ˆã€‚

å¾ Payload è®€å‡º sub = abc-123 â†’ çŸ¥é“æ˜¯å“ªå€‹ä½¿ç”¨è€…ã€‚

âœ… 8. å¾Œç«¯å›å‚³è³‡æ–™

å‡è¨­ User = "test@example.com
"ï¼Œå›å‚³ï¼š

{
  "id": "abc-123",
  "email": "test@example.com",
  "name": "Test User"
}

ğŸ”„ ç¸½çµæµç¨‹ï¼š

ç™»å…¥ â†’ å‰ç«¯é€å¸³å¯†çµ¦å¾Œç«¯

ç”¢ç”Ÿ Token â†’ å¾Œç«¯é©—è­‰æˆåŠŸå¾Œï¼Œç°½ç«  JWTï¼Œå›å‚³çµ¦å‰ç«¯

å„²å­˜ Token â†’ å‰ç«¯å­˜ localStorage / sessionStorage

æ”œå¸¶ Token â†’ æ¯æ¬¡ API è«‹æ±‚ï¼Œåœ¨ Authorization: Bearer <token> å‚³çµ¦å¾Œç«¯

é©—è­‰ç°½ç«  â†’ å¾Œç«¯ç”¨ secretKey é©—è­‰ Token æ²’è¢«ç«„æ”¹ï¼Œä¸”æ²’éæœŸ

æˆæ¬ŠæˆåŠŸ â†’ å›å‚³è³‡æ–™

è¦ä¸è¦æˆ‘ç›´æ¥ç”¨ C# (ASP.NET Core) å¹«ä½ å¯«ä¸€å€‹æœ€å°ç¯„ä¾‹ Login APIï¼ŒåŒ…å« ç”¢ç”Ÿ JWT + å›å‚³ + é©—è­‰ï¼Œä½ å¯ä»¥ç›´æ¥è·‘ï¼Ÿ

ä½ èªªï¼š
ç”¨ HMAC-SHA256 + secretKey ç®—å‡ºé›œæ¹Šï¼š => å‡ºä¾†çš„æ˜¯äº‚æ•¸éº¼? æˆ‘å¦‚æœæ‹¿åˆ°å¯ä»¥åè§£è­¯éº¼? 
ä½ é€™æ®µä¹Ÿè·³å¤ªå¤šäº†
ğŸ›¡ 7. å¾Œç«¯é©—è­‰ Token

å¾Œç«¯åšé€™äº›äº‹ï¼š

æ‹¿åˆ° Tokenï¼Œæ‹†æˆä¸‰æ®µ (Header, Payload, Signature)ã€‚

ç”¨åŒæ¨£çš„ secretKey é‡æ–°è¨ˆç®—ç°½ç« ã€‚

æ¯”å°ã€Œç®—å‡ºä¾†çš„ç°½ç« ã€ == ã€ŒToken å¸¶ä¾†çš„ç°½ç« ã€ã€‚

å¦‚æœä¸€è‡´ï¼Œè€Œä¸” exp é‚„æ²’éæœŸ â†’ Token æœ‰æ•ˆã€‚

å¾ Payload è®€å‡º sub = abc-123 â†’ çŸ¥é“æ˜¯å“ªå€‹ä½¿ç”¨è€…ã€‚
ChatGPT èªªï¼š

å¤ªæ£’äº† ğŸš€ ä½ æŠ“åˆ°é‡é»äº†ï¼æˆ‘ä¾†å¹«ä½  æ…¢æ…¢æ‹†è§£ï¼Œä¸è¦è·³å¤ªå¿«ã€‚

ğŸ§© å…ˆå›ç­”ä½ çš„å•é¡Œ

ç”¨ HMAC-SHA256 + secretKey ç®—å‡ºé›œæ¹Šï¼š => å‡ºä¾†çš„æ˜¯äº‚æ•¸éº¼? æˆ‘å¦‚æœæ‹¿åˆ°å¯ä»¥åè§£è­¯éº¼?

å‡ºä¾†çš„ä¸æ˜¯äº‚æ•¸

HMAC-SHA256 æ˜¯ä¸€ç¨®ã€Œé›œæ¹Šæ¼”ç®—æ³• (Hash)ã€ï¼ŒåŒæ¨£çš„è¼¸å…¥ + åŒæ¨£çš„ secretKeyï¼Œæ°¸é æœƒå¾—åˆ°ä¸€æ¨£çš„çµæœã€‚

ä¾‹å¦‚ï¼š

HMACSHA256("hello", "key") => abc123...
HMACSHA256("hello", "key") => abc123...  (ä¸€æ¨£)


ä¸èƒ½åè§£è­¯

é›œæ¹Šæ˜¯ å–®å‘å‡½æ•¸ï¼Œå°±åƒã€Œæœæ±æ©Ÿã€ï¼šä¸Ÿé€²å»æ°´æœåªèƒ½è®Šæˆæœæ±ï¼Œç„¡æ³•åæ¨å‡ºåŸæœ¬çš„æ°´æœã€‚

æ‰€ä»¥åˆ¥äººæ‹¿åˆ°ç°½ç«  (Signature) é€™æ®µå­—ä¸²ï¼Œä¸èƒ½åæ¨å‡º payload æˆ– secretKeyã€‚

å®‰å…¨æ€§ä¾†æº

å› ç‚ºåªæœ‰ä¼ºæœå™¨çŸ¥é“ secretKeyï¼Œæ”»æ“Šè€…å°±ç®—æ”¹äº† Payloadï¼ˆä¾‹å¦‚æŠŠ "role":"user" æ”¹æˆ "role":"admin"ï¼‰ï¼Œä¹Ÿç®—ä¸å‡ºæ­£ç¢ºçš„ç°½ç« ï¼Œä¼ºæœå™¨ä¸€é©—è­‰å°±æœƒå¤±æ•—ã€‚

ğŸ” é‚£ã€Œé©—è­‰ Tokenã€åˆ°åº•æ˜¯æ€éº¼è·‘çš„ï¼Ÿ

å‡è¨­ Token æ˜¯ï¼š

aaa.bbb.ccc


aaa = Header (Base64Url)

bbb = Payload (Base64Url)

ccc = Signature (Base64Url)

å¾Œç«¯é©—è­‰æµç¨‹ (é€æ­¥)ï¼š

æ‹†ä¸‰æ®µ

headerBase64 = aaa
payloadBase64 = bbb
signatureFromToken = ccc


é‡æ–°ç®—ç°½ç« 

expectedSignature = HMACSHA256(headerBase64 + "." + payloadBase64, secretKey)


æ¯”å°ç°½ç« 

if (expectedSignature == signatureFromToken) {
    // Token æ²’è¢«ç«„æ”¹
} else {
    // Token ç„¡æ•ˆ (å¯èƒ½è¢«å½é€ )
}


æª¢æŸ¥éæœŸæ™‚é–“

è§£é–‹ Payloadï¼ˆBase64 è§£ç¢¼ JSONï¼‰ï¼š

{
  "sub": "abc-123",
  "email": "test@example.com",
  "exp": 1712345678
}


æª¢æŸ¥ exp æ˜¯å¦å¤§æ–¼ç¾åœ¨æ™‚é–“ã€‚

å¦‚æœéæœŸ â†’ Token ç„¡æ•ˆã€‚

è®€å–ä½¿ç”¨è€…è³‡è¨Š

å¦‚æœé©—è­‰æˆåŠŸ â†’ å¾ Payload å– sub = abc-123ï¼Œå°±çŸ¥é“æ˜¯å“ªå€‹ä½¿ç”¨è€…ã€‚

ğŸ”‘ èˆ‰å€‹å¯¦éš›ä¾‹å­

Tokenï¼š

aaa.bbb.ccc


Payload è§£é–‹ï¼š

{
  "sub": "abc-123",
  "role": "user",
  "exp": 1712345678
}


æ”»æ“Šè€…æ”¹ Payloadï¼š

{
  "sub": "abc-123",
  "role": "admin",
  "exp": 1712345678
}


ç„¶å¾Œé‡æ–°ç·¨ç¢¼ â†’ è®Šæˆ aaa.fakebbb.cccã€‚

âš ï¸ å•é¡Œä¾†äº†ï¼šä»–æ²’æœ‰ä¼ºæœå™¨çš„ secretKeyï¼Œæ‰€ä»¥ç®—ä¸å‡ºåˆæ³•çš„ç°½ç« ã€‚

ä»–ç®—å‡ºä¾†çš„ signatureFake â‰  ccc

å¾Œç«¯é©—è­‰å¤±æ•— â†’ Token ç„¡æ•ˆã€‚

âœ… æ‰€ä»¥çµè«–ï¼š

ç°½ç« æ˜¯å–®å‘çš„ï¼Œä¸èƒ½åè§£ã€‚

ä¼ºæœå™¨é©—è­‰æ–¹å¼ï¼šé‡æ–°ç®—ä¸€éç°½ç«  â†’ è·Ÿ Token è£¡çš„æ¯”å°ã€‚

Payload æ˜¯å¯è®€çš„ï¼ˆBase64ï¼‰ï¼Œç°½ç« æ‰æ˜¯å®‰å…¨çš„æ ¸å¿ƒã€‚

