<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CORS æ©Ÿåˆ¶</title>
</head>

<body>
    <h1>CORS æ©Ÿåˆ¶</h1>

    <h2>ä»€éº¼æ˜¯ CORSï¼Ÿ</h2>
    <p>CORSï¼ˆCross-Origin Resource Sharingï¼Œè·¨ä¾†æºè³‡æºå…±äº«ï¼‰æ˜¯ç€è¦½å™¨çš„å®‰å…¨æ©Ÿåˆ¶ï¼Œç”¨ä¾†æ§åˆ¶ç¶²é å¾ä¸åŒä¾†æºè«‹æ±‚è³‡æºçš„è¡Œç‚ºã€‚</p>
    <p><strong>åŒæºå®šç¾©ï¼š</strong>å”è­°ã€åŸŸåã€åŸ è™Ÿä¸‰è€…å¿…é ˆå®Œå…¨ç›¸åŒã€‚</p>

    <hr>

    <h2>æƒ…æ³ä¸€ï¼šJavaScript fetch() è·¨åŸŸè«‹æ±‚</h2>
    <p><strong>å‰ç«¯ï¼š</strong><code>http://192.168.0.12:5500/client.html</code></p>
    <p><strong>å¾Œç«¯ï¼š</strong><code>http://localhost:3000/api/hello</code></p>
    <p><strong>çµæœï¼š</strong>âŒ CORS éŒ¯èª¤ï¼ˆä¸åŒä¾†æºï¼‰</p>

    <pre>const res = await fetch('http://localhost:3000/api/hello');</pre>

    <hr>

    <h2>æƒ…æ³äºŒï¼šHTML æ¨™ç±¤è¼‰å…¥è³‡æºï¼ˆä¸å— CORS é™åˆ¶ï¼‰</h2>

    <h3>å¾Œç«¯ç¨‹å¼ç¢¼ï¼š</h3>
    <pre>const http = require('http');

const server = http.createServer((req, res) => {
  if (req.method === 'GET' && req.url === '/api/hello') {
    const css = `
      body { background-color: pink; }
      h1 { color: red; }
    `;
    
    // æ•…æ„ä¸çµ¦ CORS header
    res.writeHead(200, { 'Content-Type': 'text/css' });
    res.end(css);
  } else {
    res.writeHead(404, { 'Content-Type': 'text/plain' });
    res.end('Not Found');
  }
});

server.listen(3000, () => console.log(`Server running at http://localhost:3000`));</pre>

    <h3>å‰ç«¯ç¨‹å¼ç¢¼ï¼š</h3>
    <pre>&lt;link rel="stylesheet" href="http://localhost:3000/api/hello"&gt;</pre>

    <p><strong>çµæœï¼š</strong>âœ… è«‹æ±‚æˆåŠŸï¼ŒCSS æ¨£å¼æ­£å¸¸æ‡‰ç”¨</p>
    <p><strong>åŸå› ï¼š</strong><code>&lt;link&gt;</code>ã€<code>&lt;script src&gt;</code>ã€<code>&lt;img src&gt;</code> ç­‰æ¨™ç±¤æ˜¯ã€Œé
        CORS Fetch é¡è«‹æ±‚ã€ï¼Œä¸å— CORS é™åˆ¶ã€‚</p>

    <h3>ä»€éº¼æ˜¯ MIME typeï¼Ÿ</h3>
    <p>MIME type ç”¨ä¾†æ¨™è­˜ç¶²è·¯ä¸Šå‚³è¼¸çš„æ–‡ä»¶é¡å‹ï¼Œå‘Šè¨´ç€è¦½å™¨å¦‚ä½•è™•ç†æ–‡ä»¶ã€‚</p>
    <table border="1" cellpadding="8" cellspacing="0">
        <tr>
            <th>MIME type</th>
            <th>èªªæ˜</th>
        </tr>
        <tr>
            <td>text/html</td>
            <td>HTML æ–‡ä»¶</td>
        </tr>
        <tr>
            <td>text/css</td>
            <td>CSS æ¨£å¼è¡¨</td>
        </tr>
        <tr>
            <td>application/javascript</td>
            <td>JavaScript æ–‡ä»¶</td>
        </tr>
        <tr>
            <td>image/png</td>
            <td>PNG åœ–åƒ</td>
        </tr>
        <tr>
            <td>image/jpeg</td>
            <td>JPEG åœ–åƒ</td>
        </tr>
    </table>

    <hr>

    <h2>CORS æª¢æŸ¥è¦å‰‡å°ç…§è¡¨</h2>

    <h3>âœ… æœƒè§¸ç™¼ CORS æª¢æŸ¥ï¼ˆéœ€è¦ä¼ºæœå™¨å›æ‡‰ Access-Control-Allow-Originï¼‰</h3>
    <table border="1" cellpadding="8" cellspacing="0">
        <tr>
            <th>è«‹æ±‚æ–¹å¼</th>
            <th>æ˜¯å¦è§¸ç™¼ CORS</th>
            <th>æ˜¯å¦éœ€è¦ CORS Header</th>
        </tr>
        <tr>
            <td>fetch()</td>
            <td>âœ… æœƒ</td>
            <td>âœ… éœ€è¦</td>
        </tr>
        <tr>
            <td>XMLHttpRequest (AJAX)</td>
            <td>âœ… æœƒ</td>
            <td>âœ… éœ€è¦</td>
        </tr>
        <tr>
            <td>Axios / GraphQL</td>
            <td>âœ… æœƒ</td>
            <td>âœ… éœ€è¦</td>
        </tr>
    </table>

    <h3>âŒ ä¸æœƒè§¸ç™¼ CORS æª¢æŸ¥ï¼ˆno-cors æ¨¡å¼ï¼‰</h3>
    <table border="1" cellpadding="8" cellspacing="0">
        <tr>
            <th>HTML å…ƒç´ </th>
            <th>æ˜¯å¦è§¸ç™¼ CORS</th>
            <th>æ˜¯å¦ç™¼å‡ºè«‹æ±‚</th>
            <th>çµæœ</th>
        </tr>
        <tr>
            <td>&lt;form action="..."&gt;</td>
            <td>âŒ ä¸æœƒ</td>
            <td>âœ… æœƒ</td>
            <td>ä¼ºæœå™¨æœƒæ”¶åˆ°è³‡æ–™ï¼Œç€è¦½å™¨æœƒç›´æ¥å°é </td>
        </tr>
        <tr>
            <td>&lt;img src="..."&gt;</td>
            <td>âŒ ä¸æœƒ</td>
            <td>âœ… æœƒ</td>
            <td>ä¼ºæœå™¨æœƒæ”¶åˆ° GET</td>
        </tr>
        <tr>
            <td>&lt;link rel="stylesheet"&gt;</td>
            <td>âŒ ä¸æœƒ</td>
            <td>âœ… æœƒ</td>
            <td>è‹¥ MIME ç‚º text/cssï¼Œæ¨£å¼å¯ç”¨</td>
        </tr>
        <tr>
            <td>&lt;script src="..."&gt;</td>
            <td>âŒ ä¸æœƒ</td>
            <td>âœ… æœƒ</td>
            <td>å¯åŸ·è¡Œï¼ˆä½†ç„¡æ³•å–å›å…§å®¹ï¼‰</td>
        </tr>
        <tr>
            <td>&lt;iframe&gt;</td>
            <td>âŒ ä¸æœƒ</td>
            <td>âœ… æœƒè¼‰å…¥</td>
            <td>ä¸æœƒæ“‹ï¼ˆä½†ä¸èƒ½æ“ä½œå…§å®¹ï¼‰</td>
        </tr>
    </table>

    <hr>

    <h2>æƒ…æ³ä¸‰ï¼šè¡¨å–®è·¨åŸŸæäº¤</h2>

    <h3>å¾Œç«¯ç¨‹å¼ç¢¼ï¼š</h3>
    <pre>res.writeHead(200, {'Content-Type': 'text/html; charset=utf-8' });
res.end(`
  &lt;h2&gt;ä¼ºæœå™¨å·²æ”¶åˆ°è¡¨å–®è³‡æ–™ âœ…&lt;/h2&gt;
  &lt;p&gt;name: ${parsed.name}&lt;/p&gt;
  &lt;p&gt;message: ${parsed.message}&lt;/p&gt;
  &lt;a href="/"&gt;è¿”å›&lt;/a&gt;
`);</pre>

    <h3>å‰ç«¯ç¨‹å¼ç¢¼ï¼š</h3>
    <pre>&lt;form action="http://localhost:3000/api/form" method="POST"&gt;
  &lt;label&gt;
    Name:
    &lt;input type="text" name="name" value="Yunxiang"&gt;
  &lt;/label&gt;
  &lt;br&gt;&lt;br&gt;
  &lt;label&gt;
    Message:
    &lt;input type="text" name="message" value="Hello from frontend!"&gt;
  &lt;/label&gt;
  &lt;br&gt;&lt;br&gt;
  &lt;button type="submit"&gt;é€å‡ºè¡¨å–®&lt;/button&gt;
&lt;/form&gt;</pre>

    <h3>Node server é¡¯ç¤ºï¼š</h3>
    <pre>ğŸ“© æ”¶åˆ°è¡¨å–®è³‡æ–™: [Object: null prototype] {
  name: 'Yunxiang',
  message: 'Hello from frontend!'
}</pre>

    <p><strong>çµè«–ï¼š</strong>âœ… è¡¨å–®è·¨åŸŸæäº¤å¯ä»¥æˆåŠŸï¼Œä¸æœƒè¢« CORS æ“‹ä¸‹ã€‚é€™æ˜¯å®Œæ•´é é¢å°å‘ï¼Œå‰ç«¯ JS ç„¡æ³•æ””æˆªæˆ–å–å›å›æ‡‰ã€‚</p>

    <hr>

    <h2>æƒ…æ³å››ï¼šå¾Œç«¯å…è¨±è·¨åŸŸ</h2>

    <h3>å¾Œç«¯ç¨‹å¼ç¢¼ï¼š</h3>
    <pre>res.setHeader('Access-Control-Allow-Origin', '*');
res.setHeader('Access-Control-Allow-Methods', 'GET, POST, OPTIONS');
res.setHeader('Access-Control-Allow-Headers', 'Content-Type');</pre>

    <h3>å‰ç«¯ç¨‹å¼ç¢¼ï¼š</h3>
    <pre>fetch('http://localhost:3000/api/hello')</pre>

    <p><strong>çµæœï¼š</strong>âœ… æˆåŠŸæ”¶åˆ°ï¼š<code>"message": "Hello from backend ğŸ‘‹ (CORS enabled)"</code></p>

    <hr>

    <h2>CORS é‹ä½œæ©Ÿåˆ¶ç¸½çµ</h2>

    <h3>ğŸ§  é—œéµè§€å¿µ</h3>
    <ul>
        <li>CORS æ˜¯<strong>ç€è¦½å™¨å®‰å…¨æ©Ÿåˆ¶</strong>ï¼Œä¸æ˜¯ HTTP å”å®šçš„ç¨ç«‹å»¶ä¼¸</li>
        <li>åªåœ¨ã€Œç€è¦½å™¨ã€æœƒè¢«å¼·åˆ¶åŸ·è¡Œï¼ˆcurlã€Postman ä¸å—å½±éŸ¿ï¼‰</li>
        <li><strong>è·¨åŸŸå®šç¾©ï¼š</strong>å”å®šã€ä¸»æ©Ÿåæˆ–åŸ è™Ÿä»»ä¸€ä¸åŒ</li>
        <li>æ±ºå®šæ¬Šåœ¨ã€Œå¾Œç«¯ä¼ºæœå™¨ã€ï¼Œå‰ç«¯ç„¡æ³•å¼·åˆ¶é–‹å•Ÿè·¨åŸŸ</li>
    </ul>

    <h3>åŒæºåˆ¤æ–·ç¯„ä¾‹</h3>
    <table border="1" cellpadding="8" cellspacing="0">
        <tr>
            <th>å‰ç«¯é é¢</th>
            <th>å¾Œç«¯ API</th>
            <th>æ˜¯å¦åŒæº</th>
        </tr>
        <tr>
            <td>http://localhost:3000</td>
            <td>http://localhost:3000</td>
            <td>âœ… åŒæº</td>
        </tr>
        <tr>
            <td>http://localhost:5500</td>
            <td>http://localhost:3000</td>
            <td>âŒ ä¸åŒæºï¼ˆåŸ è™Ÿä¸åŒï¼‰</td>
        </tr>
        <tr>
            <td>https://example.com</td>
            <td>http://example.com</td>
            <td>âŒ ä¸åŒæºï¼ˆå”å®šä¸åŒï¼‰</td>
        </tr>
    </table>

    <hr>

    <h2>å…©ç¨®è«‹æ±‚é¡å‹</h2>

    <h3>1ï¸âƒ£ ç°¡å–®è«‹æ±‚ï¼ˆSimple Requestï¼‰</h3>
    <p><strong>æ¢ä»¶ï¼š</strong></p>
    <ul>
        <li>æ–¹æ³•æ˜¯ GETã€POST æˆ– HEAD</li>
        <li>Header åƒ…åŒ…å«å®‰å…¨æ¨™é ­ï¼ˆå¦‚ Acceptã€Content-Type æ˜¯ application/x-www-form-urlencodedã€text/plain æˆ– multipart/form-dataï¼‰
        </li>
    </ul>
    <p><strong>æµç¨‹ï¼š</strong></p>
    <ol>
        <li>ç€è¦½å™¨ç›´æ¥é€å‡ºè«‹æ±‚</li>
        <li>å¾Œç«¯å›æ‡‰æ™‚è‹¥åŒ…å« <code>Access-Control-Allow-Origin</code>ï¼Œç€è¦½å™¨å…è¨± JS ä½¿ç”¨</li>
        <li>å¦å‰‡å³ä½¿ä¼ºæœå™¨æœ‰å›æ‡‰ï¼ŒJS ä»æœƒå ±éŒ¯</li>
    </ol>

    <h3>2ï¸âƒ£ éç°¡å–®è«‹æ±‚ï¼ˆNon-Simple Requestï¼‰</h3>
    <p><strong>æ¢ä»¶ï¼š</strong></p>
    <ul>
        <li>ä½¿ç”¨ PUTã€DELETEã€PATCH æ–¹æ³•</li>
        <li>æˆ–è‡ªè¨‚ headerï¼ˆä¾‹å¦‚ Authorizationï¼‰</li>
        <li>æˆ– Content-Type: application/json</li>
    </ul>
    <p><strong>æµç¨‹ï¼š</strong>æœƒå¤šå‡ºã€Œé æª¢è«‹æ±‚ï¼ˆPreflight Requestï¼‰ã€</p>

    <hr>

    <h2>é æª¢è«‹æ±‚ï¼ˆPreflight Requestï¼‰</h2>

    <p>ç•¶ç€è¦½å™¨åµæ¸¬é€™æ˜¯ã€Œéç°¡å–®è«‹æ±‚ã€æ™‚ï¼š</p>

    <h3>1. ç€è¦½å™¨å…ˆé€å‡º OPTIONS è«‹æ±‚</h3>
    <pre>OPTIONS /api/data HTTP/1.1
Origin: http://localhost:5500
Access-Control-Request-Method: POST
Access-Control-Request-Headers: Content-Type</pre>

    <h3>2. å¾Œç«¯å¿…é ˆå›è¦†å…è¨±è³‡è¨Š</h3>
    <pre>HTTP/1.1 204 No Content
Access-Control-Allow-Origin: http://localhost:5500
Access-Control-Allow-Methods: GET, POST, OPTIONS
Access-Control-Allow-Headers: Content-Type</pre>

    <h3>3. ç€è¦½å™¨æª¢æŸ¥çµæœ</h3>
    <ul>
        <li>è‹¥å…è¨± â†’ ç€è¦½å™¨æ‰æœƒçœŸæ­£é€å‡ºå¯¦éš›è«‹æ±‚</li>
        <li>è‹¥ä¸å…è¨± â†’ ç€è¦½å™¨ç›´æ¥é˜»æ­¢ï¼Œä¸æœƒç™¼å‡ºçœŸæ­£çš„è«‹æ±‚</li>
    </ul>

    <hr>

    <h2>å¸¸è¦‹ CORS Header èªªæ˜</h2>

    <table border="1" cellpadding="8" cellspacing="0">
        <tr>
            <th>Header</th>
            <th>åŠŸèƒ½</th>
        </tr>
        <tr>
            <td>Access-Control-Allow-Origin</td>
            <td>æŒ‡å®šå…è¨±çš„ä¾†æºï¼ˆ* æˆ–ç‰¹å®š domainï¼‰</td>
        </tr>
        <tr>
            <td>Access-Control-Allow-Methods</td>
            <td>å…è¨±çš„ HTTP æ–¹æ³•ï¼Œä¾‹å¦‚ GET, POST, OPTIONS</td>
        </tr>
        <tr>
            <td>Access-Control-Allow-Headers</td>
            <td>å…è¨±çš„è‡ªè¨‚æ¨™é ­ï¼Œä¾‹å¦‚ Content-Type, Authorization</td>
        </tr>
        <tr>
            <td>Access-Control-Allow-Credentials</td>
            <td>è‹¥è¦å…è¨± cookieï¼Œè¦è¨­ true ä¸¦ä¸”ä¸èƒ½ç”¨ *</td>
        </tr>
        <tr>
            <td>Access-Control-Max-Age</td>
            <td>é æª¢çµæœå¯è¢«å¿«å–çš„ç§’æ•¸ï¼Œæ¸›å°‘é‡è¤‡é æª¢</td>
        </tr>
    </table>

    <h3>å¾Œç«¯è¨­å®šç¯„ä¾‹ï¼ˆNode.js / Expressï¼‰</h3>
    <pre>// å…è¨±æ‰€æœ‰ç¶²åŸŸ
res.setHeader('Access-Control-Allow-Origin', '*');

// åƒ…å…è¨±ç‰¹å®šç¶²åŸŸ
res.setHeader('Access-Control-Allow-Origin', 'https://myfrontend.com');</pre>

    <hr>

    <h2>å®Œæ•´è«‹æ±‚æµç¨‹åœ–ï¼ˆéç°¡å–®è«‹æ±‚ï¼‰</h2>

    <pre>å‰ç«¯ fetch() 
    â†“
ç€è¦½å™¨åµæ¸¬è·¨åŸŸ
    â†“
ç™¼å‡º OPTIONS é æª¢
    â†“
å¾Œç«¯æ”¶åˆ° OPTIONS â†’ å›è¦†å…è¨±çš„ CORS Header
    â†“
ç€è¦½å™¨æª¢æŸ¥å…è¨±
    â†“
ç™¼å‡ºå¯¦éš› POST
    â†“
å¾Œç«¯å›æ‡‰ â†’ è‹¥å« Access-Control-Allow-Origin â†’ JS å¯å­˜å–</pre>

    <hr>

    <h2>ğŸš¨ CORS çš„çœŸæ­£æ„ç¾©</h2>

    <ul>
        <li>CORS ä¸æ˜¯ä¼ºæœå™¨é˜²ç«ç‰†</li>
        <li>è€Œæ˜¯ç€è¦½å™¨çš„ã€ŒåŒæºå®‰å…¨æ©Ÿåˆ¶ï¼ˆSame-Origin Policyï¼‰ã€çš„ä¸€éƒ¨åˆ†</li>
        <li>å®ƒåªå½±éŸ¿ã€Œå‰ç«¯ JS æƒ³è¦è®€å–è·¨åŸŸå›æ‡‰å…§å®¹ã€çš„æƒ…æ³</li>
        <li><strong>å®ƒä¸æœƒé˜»æ­¢è«‹æ±‚è¢«é€å‡º</strong></li>
    </ul>

    <hr>

    <h2>ğŸ“Œ è£œå……é‡é»</h2>

    <ul>
        <li>è‹¥å¾Œç«¯æ²’è™•ç† OPTIONSï¼Œç€è¦½å™¨æœƒå ±ï¼š<code>CORS preflight response is invalid</code></li>
        <li>curlã€Postman ä¸æœƒå— CORS é™åˆ¶ï¼ˆå› ç‚ºé‚£æ˜¯ç€è¦½å™¨æ©Ÿåˆ¶ï¼‰</li>
        <li>è‹¥å¾Œç«¯ç”¨ nginxã€Apache ç­‰ï¼Œä¹Ÿå¯ä»¥åœ¨ä¼ºæœå™¨å±¤è¨­å®š Headerï¼ˆä¸æ˜¯ç¨‹å¼å±¤ï¼‰</li>
    </ul>
    <hr>
    <h1>CORS èˆ‡ Cookie çš„é—œä¿‚</h1>

    <h2>æƒ…æ³ä¸€ï¼šåŒæºè¨­å®š Cookie</h2>

    <h3>å¾Œç«¯ç¨‹å¼ç¢¼ï¼š</h3>
    <pre>res.setHeader('Set-Cookie', 'user=yunxiang; HttpOnly; Path=/; SameSite=Lax');
res.writeHead(200, { 'Content-Type': 'application/json' });
res.end(JSON.stringify({ message: 'âœ… Cookie å·²è¨­å®šï¼ˆåŒæºï¼‰' }));</pre>

    <h3>å‰ç«¯ç¨‹å¼ç¢¼ï¼š</h3>
    <pre>const res = await fetch('/api/setcookie');</pre>

    <h3>çµæœï¼š</h3>
    <ul>
        <li>HTML èˆ‡ API å®Œå…¨åŒæºï¼ˆå”å®šã€hostã€port å…¨ç›¸åŒï¼‰</li>
        <li>ç„¡éœ€è¨­å®š CORS</li>
        <li>Cookie è‡ªå‹•è¢«å„²å­˜ã€é™„å¸¶</li>
    </ul>

    <hr>

    <h2>æƒ…æ³äºŒï¼šä½¿ç”¨ Form è¡¨å–®è·¨åŸŸæäº¤</h2>

    <p><strong>å‡è¨­ï¼š</strong></p>
    <ul>
        <li>å‰ç«¯ HTMLï¼š<code>http://localhost:5500/index.html</code></li>
        <li>å¾Œç«¯ APIï¼š<code>http://localhost:3000/set-cookie</code></li>
    </ul>

    <h3>å‰ç«¯ç¨‹å¼ç¢¼ï¼š</h3>
    <pre>&lt;form action="http://localhost:3000/set-cookie" method="POST"&gt;
  &lt;button type="submit"&gt;é€å‡ºè¡¨å–®&lt;/button&gt;
&lt;/form&gt;</pre>

    <h3>ğŸ’¡ è¡¨å–®é€å‡ºçš„å±¬æ€§</h3>
    <p>ç•¶ä½¿ç”¨ <code>&lt;form&gt;</code> æ™‚ï¼Œç€è¦½å™¨æœƒç›´æ¥ç™¼å‡º HTTP Requestï¼Œç”±ã€Œç€è¦½å™¨ä¸»å°ã€ï¼Œä¸æ˜¯ç”¨ fetch()ï¼Œä¹Ÿæ²’æœ‰ JavaScript CORS çš„æ¦‚å¿µã€‚</p>
    <pre>POST /set-cookie HTTP/1.1
Host: localhost:3000
Origin: http://localhost:5500
Content-Type: application/x-www-form-urlencoded</pre>
    <p>ç€è¦½å™¨é‚„æ˜¯æœƒé™„ä¸Š Origin header å‘Šè¨´ä¼ºæœå™¨ã€Œæˆ‘æ˜¯èª°ç™¼çš„ã€ã€‚</p>

    <h3>ğŸª ä¼ºæœå™¨çš„å›æ‡‰ï¼ˆSet-Cookieï¼‰</h3>
    <p>å¦‚æœå¾Œç«¯å›æ‡‰ï¼š</p>
    <pre>Set-Cookie: token=12345; Path=/;</pre>

    <p><strong>çµæœï¼š</strong></p>
    <ul>
        <li>é€™å€‹ Cookie <strong>ä¸æœƒå­˜åˆ°å‰ç«¯çš„ç¶²åŸŸ</strong> (localhost:5500)</li>
        <li>è€Œæ˜¯æœƒè¢«ç€è¦½å™¨æ­¸é¡æˆ<strong>ã€Œå±¬æ–¼ localhost:3000ã€çš„ Cookie</strong></li>
        <li>å®ƒæœƒå­˜åœ¨ç€è¦½å™¨å…§çš„ Cookie jar ä¸­ï¼Œä½†åªèƒ½è¢« localhost:3000 ä½¿ç”¨</li>
        <li>localhost:5500 çš„ JS æˆ– document.cookie çœ‹ä¸åˆ°é€™å€‹ Cookie</li>
        <li>âœ… ç€è¦½å™¨æœƒæ¥å—ï¼Œä½†åªå±¬æ–¼ localhost:3000 ç¶²åŸŸ</li>
    </ul>
    <p>èˆ‰ä¾‹:</p>
    <p>å‰ç«¯</p>
    <pre><code>
&lt;form action="http://localhost:3000/submit" method="POST" target="_blank"&gt;
    &lt;input type="text" name="username" value="testUser" /&gt;
    &lt;button type="submit"&gt;é€å‡º&lt;/button&gt;
&lt;/form&gt;
</code></pre>
    <p>å¾Œç«¯</p>
    <pre>
<pre><code>
if (req.method === "POST" && req.url === "/submit") {
    // è¨­å®šä¸€å€‹ cookie
    res.statusCode = 200;
    res.setHeader("Content-Type", "text/html");
    res.setHeader("Set-Cookie", "formToken=123456; Path=/; SameSite=None; Secure");
    res.end("&lt;h1&gt;Cookie å·²è¨­å®šï¼ˆfrom localhost:3000ï¼‰&lt;/h1&gt;");
} else {
    res.statusCode = 200;
    res.setHeader("Content-Type", "text/html");
    res.end("&lt;h1&gt;Server OK&lt;/h1&gt;");
}
</code></pre>
    </pre>
    <p>çµæœ: é é¢å°å‘äº†http://localhost:3000/submitï¼Œä¸”cookieå¯«åœ¨é€™è£¡ï¼Œå±¬æ–¼é€™è£¡</p>

    <hr>

    <h2>ä»€éº¼æ˜¯ Cookie jarï¼Ÿ</h2>

    <h3>ğŸª ä¸€å¥è©±å®šç¾©</h3>
    <p><strong>Cookie jarï¼ˆCookie ç½ï¼‰</strong>æ˜¯ç€è¦½å™¨ç”¨ä¾†é›†ä¸­å„²å­˜ä¸¦ç®¡ç† Cookie çš„åœ°æ–¹ã€‚æ¯å€‹ç€è¦½å™¨éƒ½æœƒæœ‰ä¸€å€‹ã€ŒCookie å„²å­˜ç³»çµ±ã€ï¼Œè£¡é¢å­˜äº†æ‰€æœ‰ç¶²ç«™è¨­å®šéçš„ Cookieã€‚</p>

    <h3>Cookie Jar çµæ§‹ç¯„ä¾‹ï¼š</h3>
    <pre>Cookie Jar
â”œâ”€â”€ localhost:3000
â”‚   â”œâ”€â”€ user=alice
â”‚   â”œâ”€â”€ token=abc123; HttpOnly
â”‚
â”œâ”€â”€ example.com
â”‚   â”œâ”€â”€ sessionid=xyz789
â”‚   â””â”€â”€ lang=zh-TW
â”‚
â””â”€â”€ google.com
    â”œâ”€â”€ PREF=1234
    â””â”€â”€ SID=abcd</pre>

    <p>ç•¶ä½ è¨ªå• <code>http://localhost:3000/api/profile</code>ï¼Œç€è¦½å™¨å°±æœƒå¾é€™å€‹ jar è£¡ï¼ŒæŒ‘å‡ºã€Œå±¬æ–¼ localhost:3000ã€çš„ Cookieï¼Œç„¶å¾Œåœ¨è«‹æ±‚æ™‚è‡ªå‹•åŠ ä¸Šï¼š</p>
    <pre>Cookie: user=alice; token=abc123</pre>

    <h3>ç¨ç«‹æ€§</h3>
    <p>å‡è¨­ä½ çš„é›»è…¦é–‹äº†ä¸‰å€‹ç¶²ç«™ï¼š</p>
    <ol>
        <li>https://facebook.com</li>
        <li>https://google.com</li>
        <li>https://localhost:3000</li>
    </ol>
    <p>ä½ çš„ç€è¦½å™¨å…¶å¯¦æœƒç¶­è­·ä¸‰å€‹ã€Œä¸åŒçš„ Cookie jar å€å¡Šã€ã€‚å®ƒå€‘ä¹‹é–“å®Œå…¨ç¨ç«‹ï¼Œå½¼æ­¤çœ‹ä¸åˆ°ã€‚å“ªæ€•ä½ ç”¨è¡¨å–®è·¨åŸŸæäº¤çµ¦å°æ–¹ï¼Œä¹Ÿåªæœƒè®“å°æ–¹çš„é‚£å€‹ jar æ–°å¢ Cookieã€‚</p>

    <h3>ğŸ§­ åœ¨ã€Œç€è¦½å™¨ã€ä¸­çš„ Cookie jar å„²å­˜ä½ç½®</h3>
    <p>ç€è¦½å™¨çš„ Cookie ä¸æ˜¯æ”¾åœ¨å–®ä¸€æª”æ¡ˆï¼Œè€Œæ˜¯æ”¾åœ¨ã€Œä½¿ç”¨è€…è³‡æ–™ç›®éŒ„ï¼ˆUser Data Directoryï¼‰ã€è£¡çš„ä¸€å€‹è³‡æ–™åº«æª”æ¡ˆä¸­ã€‚ç¾ä»£ç€è¦½å™¨å¹¾ä¹éƒ½ç”¨ SQLite ä¾†å­˜ Cookieã€‚</p>
    <p><strong>ä»¥ Windows Chrome ç‚ºä¾‹ï¼š</strong></p>
    <pre>C:\Users\&lt;ä½ çš„ä½¿ç”¨è€…åç¨±&gt;\AppData\Local\Google\Chrome\User Data\Default\Network\Cookies</pre>

    <hr>

    <h2>æƒ…æ³ä¸‰ï¼šè·¨åŸŸä½†æœªå…è¨±æ†‘è­‰ï¼ˆéŒ¯èª¤ç¤ºç¯„ï¼‰</h2>

    <p><strong>å‰ç«¯åœ¨ï¼š</strong><code>http://localhost:5500</code></p>
    <p><strong>å¾Œç«¯åœ¨ï¼š</strong><code>http://localhost:3000</code></p>

    <h3>å‰ç«¯ç¨‹å¼ç¢¼ï¼š</h3>
    <pre>const res = await fetch('http://localhost:3000/set-cookie', {
    method: 'GET',
    credentials: 'include' // å˜—è©¦æ”œå¸¶ cookie
});</pre>

    <h3>å¾Œç«¯ç¨‹å¼ç¢¼ï¼š</h3>
    <pre>// âœ… æŒ‡å®šæ˜ç¢ºç¶²åŸŸï¼ˆä¸è¦ç”¨ *ï¼‰
res.setHeader('Access-Control-Allow-Origin', 'http://192.168.0.12:5500');
// ğŸš« ä¸å…è¨± credentialsï¼ˆç…§ä½ çš„è¨­å®šï¼‰
res.setHeader('Set-Cookie', 'token=abc123; Path=/; SameSite=None; Secure');
res.setHeader('Content-Type', 'application/json');
res.end(JSON.stringify({ message: 'å…è¨±è·¨åŸŸï¼Œä½†ä¸å…è¨± credentials' }));</pre>

    <h3>çµæœï¼š</h3>
    <p><strong>âŒ éŒ¯èª¤è¨Šæ¯ï¼š</strong></p>
    <pre>The value of the 'Access-Control-Allow-Credentials' header in the response is ''
which must be 'true' when the request's credentials mode is 'include'.</pre>

    <p><strong>åŸå› åˆ†æï¼š</strong></p>
    <ul>
        <li>å‰ç«¯ <code>fetch(..., { credentials: 'include' })</code> âœ… å¸¶äº†æ†‘è­‰æ¨¡å¼</li>
        <li>ä¼ºæœå™¨æœ‰å›æ‡‰ <code>Access-Control-Allow-Origin</code> âœ…</li>
        <li>ä½†æ˜¯ä¼ºæœå™¨æ²’å›å‚³ <code>Access-Control-Allow-Credentials: true</code></li>
        <li>æ‰€ä»¥ç€è¦½å™¨ç›´æ¥æ“‹æ‰ï¼Œé€£ response éƒ½æ‹¿ä¸åˆ°</li>
    </ul>

    <h3>ğŸ’¡ èƒŒå¾Œé‚è¼¯ï¼ˆCORS + Cookie = é›™ä¿è­·æ©Ÿåˆ¶ï¼‰</h3>
    <p>ç•¶ä½ ç”¨ <code>credentials: 'include'</code> æ™‚ï¼Œç€è¦½å™¨è¦æ±‚ä¼ºæœå™¨åŒæ™‚æ˜ç¢ºè¡¨æ…‹ï¼šã€Œä½ ç¢ºå®šå…è¨±é€™å€‹ä¾†æºå¸¶ Cookie å—ï¼Ÿã€</p>
    <p>ä¼ºæœå™¨å¿…é ˆåœ¨ Response Header æ˜ç¢ºå›ï¼š</p>
    <pre>Access-Control-Allow-Credentials: true</pre>
    <p>å¦å‰‡ â†’ ç€è¦½å™¨å ±éŒ¯ã€è«‹æ±‚å¤±æ•—ï¼ˆä¸æ˜¯ä¸Ÿæ£„ Cookieï¼Œæ˜¯æ•´å€‹æ“‹ï¼‰ã€‚</p>

    <h3>ğŸš¨ é‡è¦è¦å‰‡ï¼šæ ¹æ“š W3C CORS è¦ç¯„</h3>
    <p>ç•¶ä½ æœ‰ <code>credentials: 'include'</code>ï¼ˆå³å¸¶ Cookie / Authorizationï¼‰ï¼Œä¼ºæœå™¨<strong>ä¸èƒ½ç”¨è¬ç”¨å­—å…ƒ *</strong>
        å…è¨±è·¨åŸŸã€‚å¦å‰‡ç€è¦½å™¨èªç‚ºé€™æ¨£å¤ªå±éšªã€‚</p>

    <hr>

    <h2>æƒ…æ³å››ï¼šè·¨åŸŸè¨­å®š Cookie æ­£ç¢ºåšæ³•</h2>

    <h3>å‰ç«¯ç¨‹å¼ç¢¼ï¼š</h3>
    <pre>const res = await fetch('http://localhost:3000/set-cookie', {
    method: 'GET',
    credentials: 'include' // æ”œå¸¶ cookie
});</pre>

    <h3>å¾Œç«¯ç¨‹å¼ç¢¼ï¼š</h3>
    <pre>res.setHeader('Access-Control-Allow-Origin', origin);
res.setHeader('Access-Control-Allow-Credentials', 'true'); // âœ… å¿…é ˆè¦æœ‰
res.setHeader('Content-Type', 'application/json');
res.setHeader('Set-Cookie', 'token=abc123; Path=/; SameSite=None; Secure'); // âœ… å¯¦éš›è¨­å®š Cookie</pre>

    <h3>çµæœï¼š</h3>
    <p>âœ… æˆåŠŸè¨­å®š Cookie</p>
    <ul>
        <li><strong>åç¨±ï¼š</strong>user</li>
        <li><strong>å€¼ï¼š</strong>yunxiang</li>
        <li><strong>Domainï¼š</strong>localhost</li>
    </ul>

    <hr>

    <h2>ğŸª é‡é»ï¼šCookie å±¬æ–¼ã€Œè¨­å®šå®ƒçš„ç¶²åŸŸ (Domain)ã€</h2>

    <h3>ğŸ” çµæœï¼š</h3>
    <p>é€™å€‹ Cookie åªæœƒè¢«ç€è¦½å™¨è‡ªå‹•é™„åŠ åœ¨ã€Œé€å¾€ localhost:3000ã€çš„è«‹æ±‚ä¸­ã€‚ä»»ä½•æ‰“å»å…¶ä»–åŸŸåï¼ˆä¾‹å¦‚ 192.168.0.12:5500ï¼‰çš„è«‹æ±‚ï¼Œéƒ½ä¸æœƒå¸¶é€™å€‹ Cookieã€‚</p>

    <h3>ğŸ§© æƒ³è®“ Cookie åœ¨è·¨å­ç¶²åŸŸå…±äº«ï¼Ÿ</h3>
    <p>ä½ å¯ä»¥åœ¨ä¼ºæœå™¨è¨­å®šï¼š</p>
    <pre>Set-Cookie: token=abc123; Path=/; Domain=.example.com; SameSite=None; Secure</pre>

    <p><strong>æ•ˆæœï¼š</strong></p>
    <ul>
        <li>api.example.com è¨­çš„ Cookie</li>
        <li>ä¹Ÿæœƒè¢« www.example.com å¸¶ä¸Šå»</li>
        <li>ï¼ˆå› ç‚ºå®ƒå€‘åŒå±¬æ–¼ .example.comï¼‰</li>
    </ul>

    <p><strong>âš ï¸ é™åˆ¶ï¼š</strong></p>
    <p>ä½ ä¸èƒ½æŠŠ Domain è¨­æˆåˆ¥äººçš„ï¼ˆä¾‹å¦‚ .google.comï¼‰â€”â€”ç€è¦½å™¨æœƒç›´æ¥å¿½ç•¥é€™ç¨®éæ³•çš„è¨­å®šã€‚</p>

    <hr>

    <h2>ğŸ“Œ ç¸½çµå°ç…§è¡¨</h2>

    <table border="1" cellpadding="8" cellspacing="0">
        <tr>
            <th>æƒ…æ³</th>
            <th>å‰ç«¯</th>
            <th>å¾Œç«¯</th>
            <th>çµæœ</th>
        </tr>
        <tr>
            <td>åŒæº</td>
            <td>fetch('/api')</td>
            <td>Set-Cookie</td>
            <td>âœ… Cookie è‡ªå‹•å„²å­˜ã€é™„å¸¶</td>
        </tr>
        <tr>
            <td>Form è·¨åŸŸ</td>
            <td>&lt;form action="..."&gt;</td>
            <td>Set-Cookie</td>
            <td>âœ… Cookie å­˜åˆ°å¾Œç«¯ç¶²åŸŸï¼Œå‰ç«¯çœ‹ä¸åˆ°</td>
        </tr>
        <tr>
            <td>è·¨åŸŸç„¡æ†‘è­‰</td>
            <td>credentials: 'include'</td>
            <td>æœªè¨­ Allow-Credentials</td>
            <td>âŒ ç€è¦½å™¨æ“‹ä¸‹è«‹æ±‚</td>
        </tr>
        <tr>
            <td>è·¨åŸŸæ­£ç¢º</td>
            <td>credentials: 'include'</td>
            <td>Allow-Credentials: true<br>SameSite=None; Secure</td>
            <td>âœ… Cookie æˆåŠŸè¨­å®š</td>
        </tr>
    </table>

    <hr>

    <h2>ğŸ”‘ é—œéµ Cookie å±¬æ€§èªªæ˜</h2>

    <table border="1" cellpadding="8" cellspacing="0">
        <tr>
            <th>å±¬æ€§</th>
            <th>èªªæ˜</th>
        </tr>
        <tr>
            <td>HttpOnly</td>
            <td>JavaScript ç„¡æ³•é€é document.cookie è®€å–ï¼Œé˜²æ­¢ XSS æ”»æ“Š</td>
        </tr>
        <tr>
            <td>Path</td>
            <td>Cookie é©ç”¨çš„è·¯å¾‘ï¼Œé è¨­ç‚º /</td>
        </tr>
        <tr>
            <td>Domain</td>
            <td>Cookie é©ç”¨çš„åŸŸåï¼Œå¯è¨­å®šå­ç¶²åŸŸå…±äº«</td>
        </tr>
        <tr>
            <td>SameSite</td>
            <td>
                <strong>Laxï¼š</strong>åŒæºè«‹æ±‚ + é ‚å±¤å°èˆªï¼ˆå¦‚ &lt;a&gt; é€£çµï¼‰æœƒå¸¶ Cookie<br>
                <strong>Strictï¼š</strong>åªæœ‰å®Œå…¨åŒæºæ‰æœƒå¸¶ Cookie<br>
                <strong>Noneï¼š</strong>å…è¨±è·¨åŸŸï¼Œä½†å¿…é ˆé…åˆ Secure
            </td>
        </tr>
        <tr>
            <td>Secure</td>
            <td>åªåœ¨ HTTPS é€£ç·šæ™‚å‚³é€ Cookie</td>
        </tr>
    </table>
</body>

</html>